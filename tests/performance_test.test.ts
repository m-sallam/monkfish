import { Game } from "../src/game.ts";
import { performanceTesting } from "../src/performance_test.ts";
import { assertEquals } from "../dev_deps.ts";

// positions from 1 to 6 are from https://www.chessprogramming.org/Perft_Results
// random positions are from https://gist.github.com/peterellisjones/8c46c28141c162d1d8a0f0badbc9cff9

const cases = [
  {
    name: "position 1 depth 1",
    depth: 1,
    fen: "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
    nodes: 20,
    ignore: false,
  },
  {
    name: "position 1 depth 2",
    depth: 2,
    fen: "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
    nodes: 400,
    ignore: false,
  },
  {
    name: "position 1 depth 3",
    depth: 3,
    fen: "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
    nodes: 8_902,
    ignore: false,
  },
  {
    name: "position 1 depth 4",
    depth: 4,
    fen: "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
    nodes: 197_281,
    ignore: false,
  },
  {
    name: "position 1 depth 5",
    depth: 5,
    fen: "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
    nodes: 4_865_609,
    ignore: true,
  },
  {
    name: "position 1 depth 6",
    depth: 6,
    fen: "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
    nodes: 119_060_324,
    ignore: true,
  },
  {
    name: "position 2 depth 1",
    depth: 1,
    fen: "r3k2r/p1ppqpb1/bn2pnp1/3PN3/1p2P3/2N2Q1p/PPPBBPPP/R3K2R w KQkq - 0 1",
    nodes: 48,
    ignore: false,
  },
  {
    name: "position 2 depth 2",
    depth: 2,
    fen: "r3k2r/p1ppqpb1/bn2pnp1/3PN3/1p2P3/2N2Q1p/PPPBBPPP/R3K2R w KQkq - 0 1",
    nodes: 2_039,
    ignore: false,
  },
  {
    name: "position 2 depth 3",
    depth: 3,
    fen: "r3k2r/p1ppqpb1/bn2pnp1/3PN3/1p2P3/2N2Q1p/PPPBBPPP/R3K2R w KQkq - 0 1",
    nodes: 97_862,
    ignore: false,
  },
  {
    name: "position 2 depth 4",
    depth: 4,
    fen: "r3k2r/p1ppqpb1/bn2pnp1/3PN3/1p2P3/2N2Q1p/PPPBBPPP/R3K2R w KQkq - 0 1",
    nodes: 4_085_603,
    ignore: true,
  },
  {
    name: "position 2 depth 5",
    depth: 5,
    fen: "r3k2r/p1ppqpb1/bn2pnp1/3PN3/1p2P3/2N2Q1p/PPPBBPPP/R3K2R w KQkq - 0 1",
    nodes: 193_690_690,
    ignore: true,
  },
  {
    name: "position 3 depth 1",
    depth: 1,
    fen: "8/2p5/3p4/KP5r/1R3p1k/8/4P1P1/8 w - - 0 1",
    nodes: 14,
    ignore: false,
  },
  {
    name: "position 3 depth 2",
    depth: 2,
    fen: "8/2p5/3p4/KP5r/1R3p1k/8/4P1P1/8 w - - 0 1",
    nodes: 191,
    ignore: false,
  },
  {
    name: "position 3 depth 3",
    depth: 3,
    fen: "8/2p5/3p4/KP5r/1R3p1k/8/4P1P1/8 w - - 0 1",
    nodes: 2_812,
    ignore: false,
  },
  {
    name: "position 3 depth 4",
    depth: 4,
    fen: "8/2p5/3p4/KP5r/1R3p1k/8/4P1P1/8 w - - 0 1",
    nodes: 43_238,
    ignore: false,
  },
  {
    name: "position 3 depth 5",
    depth: 5,
    fen: "8/2p5/3p4/KP5r/1R3p1k/8/4P1P1/8 w - - 0 1",
    nodes: 674_624,
    ignore: false,
  },
  {
    name: "position 3 depth 6",
    depth: 6,
    fen: "8/2p5/3p4/KP5r/1R3p1k/8/4P1P1/8 w - - 0 1",
    nodes: 11_030_083,
    ignore: true,
  },
  {
    name: "position 4 depth 1",
    depth: 1,
    fen: "r3k2r/Pppp1ppp/1b3nbN/nP6/BBP1P3/q4N2/Pp1P2PP/R2Q1RK1 w kq - 0 1",
    nodes: 6,
    ignore: false,
  },
  {
    name: "position 4 depth 2",
    depth: 2,
    fen: "r3k2r/Pppp1ppp/1b3nbN/nP6/BBP1P3/q4N2/Pp1P2PP/R2Q1RK1 w kq - 0 1",
    nodes: 264,
    ignore: false,
  },
  {
    name: "position 4 depth 3",
    depth: 3,
    fen: "r3k2r/Pppp1ppp/1b3nbN/nP6/BBP1P3/q4N2/Pp1P2PP/R2Q1RK1 w kq - 0 1",
    nodes: 9_467,
    ignore: false,
  },
  {
    name: "position 4 depth 4",
    depth: 4,
    fen: "r3k2r/Pppp1ppp/1b3nbN/nP6/BBP1P3/q4N2/Pp1P2PP/R2Q1RK1 w kq - 0 1",
    nodes: 422_333,
    ignore: false,
  },
  {
    name: "position 4 depth 5",
    depth: 5,
    fen: "r3k2r/Pppp1ppp/1b3nbN/nP6/BBP1P3/q4N2/Pp1P2PP/R2Q1RK1 w kq - 0 1",
    nodes: 15_833_292,
    ignore: true,
  },
  {
    name: "position 5 depth 1",
    depth: 1,
    fen: "rnbq1k1r/pp1Pbppp/2p5/8/2B5/8/PPP1NnPP/RNBQK2R w KQ - 1 8",
    nodes: 44,
    ignore: false,
  },
  {
    name: "position 5 depth 2",
    depth: 2,
    fen: "rnbq1k1r/pp1Pbppp/2p5/8/2B5/8/PPP1NnPP/RNBQK2R w KQ - 1 8",
    nodes: 1_486,
    ignore: false,
  },
  {
    name: "position 5 depth 3",
    depth: 3,
    fen: "rnbq1k1r/pp1Pbppp/2p5/8/2B5/8/PPP1NnPP/RNBQK2R w KQ - 1 8",
    nodes: 62_379,
    ignore: false,
  },
  {
    name: "position 5 depth 4",
    depth: 4,
    fen: "rnbq1k1r/pp1Pbppp/2p5/8/2B5/8/PPP1NnPP/RNBQK2R w KQ - 1 8",
    nodes: 2_103_487,
    ignore: false,
  },
  {
    name: "position 5 depth 5",
    depth: 5,
    fen: "rnbq1k1r/pp1Pbppp/2p5/8/2B5/8/PPP1NnPP/RNBQK2R w KQ - 1 8",
    nodes: 89_941_194,
    ignore: true,
  },
  {
    name: "position 6 depth 1",
    depth: 1,
    fen:
      "r4rk1/1pp1qppp/p1np1n2/2b1p1B1/2B1P1b1/P1NP1N2/1PP1QPPP/R4RK1 w - - 0 10",
    nodes: 46,
    ignore: false,
  },
  {
    name: "position 6 depth 2",
    depth: 2,
    fen:
      "r4rk1/1pp1qppp/p1np1n2/2b1p1B1/2B1P1b1/P1NP1N2/1PP1QPPP/R4RK1 w - - 0 10",
    nodes: 2_079,
    ignore: false,
  },
  {
    name: "position 6 depth 3",
    depth: 3,
    fen:
      "r4rk1/1pp1qppp/p1np1n2/2b1p1B1/2B1P1b1/P1NP1N2/1PP1QPPP/R4RK1 w - - 0 10",
    nodes: 89_890,
    ignore: false,
  },
  {
    name: "position 6 depth 4",
    depth: 4,
    fen:
      "r4rk1/1pp1qppp/p1np1n2/2b1p1B1/2B1P1b1/P1NP1N2/1PP1QPPP/R4RK1 w - - 0 10",
    nodes: 3_894_594,
    ignore: false,
  },
  {
    name: "position 6 depth 5",
    depth: 5,
    fen:
      "r4rk1/1pp1qppp/p1np1n2/2b1p1B1/2B1P1b1/P1NP1N2/1PP1QPPP/R4RK1 w - - 0 10",
    nodes: 164_075_551,
    ignore: true,
  },
  {
    name: "random position 1",
    depth: 1,
    fen: "r6r/1b2k1bq/8/8/7B/8/8/R3K2R b KQ - 3 2",
    nodes: 8,
    ignore: false,
  },
  {
    name: "random position 2",
    depth: 1,
    fen: "8/8/8/2k5/2pP4/8/B7/4K3 b - d3 0 3",
    nodes: 8,
    ignore: false,
  },
  {
    name: "random position 3",
    depth: 1,
    fen: "r1bqkbnr/pppppppp/n7/8/8/P7/1PPPPPPP/RNBQKBNR w KQkq - 2 2",
    nodes: 19,
    ignore: false,
  },
  {
    name: "random position 4",
    depth: 1,
    fen: "r3k2r/p1pp1pb1/bn2Qnp1/2qPN3/1p2P3/2N5/PPPBBPPP/R3K2R b KQkq - 3 2",
    nodes: 5,
    ignore: false,
  },
  {
    name: "random position 5",
    depth: 1,
    fen: "2kr3r/p1ppqpb1/bn2Qnp1/3PN3/1p2P3/2N5/PPPBBPPP/R3K2R b KQ - 3 2",
    nodes: 44,
    ignore: false,
  },
  {
    name: "random position 6",
    depth: 1,
    fen: "rnb2k1r/pp1Pbppp/2p5/q7/2B5/8/PPPQNnPP/RNB1K2R w KQ - 3 9",
    nodes: 39,
    ignore: false,
  },
  {
    name: "random position 7",
    depth: 1,
    fen: "2r5/3pk3/8/2P5/8/2K5/8/8 w - - 5 4",
    nodes: 9,
    ignore: false,
  },
  {
    name: "random position 8",
    depth: 3,
    fen: "rnbq1k1r/pp1Pbppp/2p5/8/2B5/8/PPP1NnPP/RNBQK2R w KQ - 1 8",
    nodes: 62_379,
    ignore: false,
  },
  {
    name: "random position 9",
    depth: 3,
    nodes: 89_890,
    fen:
      "r4rk1/1pp1qppp/p1np1n2/2b1p1B1/2B1P1b1/P1NP1N2/1PP1QPPP/R4RK1 w - - 0 10",
    ignore: false,
  },
  {
    name: "random position 10",
    depth: 6,
    nodes: 1_134_888,
    fen: "3k4/3p4/8/K1P4r/8/8/8/8 b - - 0 1",
    ignore: false,
  },
  {
    name: "random position 11",
    depth: 6,
    nodes: 1_015_133,
    fen: "8/8/4k3/8/2p5/8/B2P2K1/8 w - - 0 1",
    ignore: false,
  },
  {
    name: "random position 12",
    depth: 6,
    nodes: 1_440_467,
    fen: "8/8/1k6/2b5/2pP4/8/5K2/8 b - d3 0 1",
    ignore: false,
  },
  {
    name: "random position 13",
    depth: 6,
    nodes: 661_072,
    fen: "5k2/8/8/8/8/8/8/4K2R w K - 0 1",
    ignore: false,
  },
  {
    name: "random position 14",
    depth: 6,
    nodes: 803_711,
    fen: "3k4/8/8/8/8/8/8/R3K3 w Q - 0 1",
    ignore: false,
  },
  {
    name: "random position 15",
    depth: 4,
    nodes: 1_274_206,
    fen: "r3k2r/1b4bq/8/8/8/8/7B/R3K2R w KQkq - 0 1",
    ignore: false,
  },
  {
    name: "random position 16",
    depth: 4,
    nodes: 1_720_476,
    fen: "r3k2r/8/3Q4/8/8/5q2/8/R3K2R b KQkq - 0 1",
    ignore: false,
  },
  {
    name: "random position 17",
    depth: 6,
    nodes: 3_821_001,
    fen: "2K2r2/4P3/8/8/8/8/8/3k4 w - - 0 1",
    ignore: false,
  },
  {
    name: "random position 18",
    depth: 5,
    nodes: 1_004_658,
    fen: "8/8/1P2K3/8/2n5/1q6/8/5k2 b - - 0 1",
    ignore: false,
  },
  {
    name: "random position 19",
    depth: 6,
    nodes: 217_342,
    fen: "4k3/1P6/8/8/8/8/K7/8 w - - 0 1",
    ignore: false,
  },
  {
    name: "random position 20",
    depth: 6,
    nodes: 92_683,
    fen: "8/P1k5/K7/8/8/8/8/8 w - - 0 1",
    ignore: false,
  },
  {
    name: "random position 21",
    depth: 6,
    nodes: 2_217,
    fen: "K1k5/8/P7/8/8/8/8/8 w - - 0 1",
    ignore: false,
  },
  {
    name: "random position 22",
    depth: 7,
    nodes: 567_584,
    fen: "8/k1P5/8/1K6/8/8/8/8 w - - 0 1",
    ignore: false,
  },
  {
    name: "random position 23",
    depth: 4,
    nodes: 23_527,
    fen: "8/8/2k5/5q2/5n2/8/5K2/8 b - - 0 1",
    ignore: false,
  },
];

cases.forEach(({ name, depth, nodes, fen, ignore }) => {
  Deno.test({
    name: `performance testing : ${name}`,
    ignore,
    fn: () => {
      const game = new Game();
      game.load(fen);
      assertEquals(nodes, performanceTesting(game, depth));
    },
  });
});
